<!DOCTYPE html><html lang="en" dir="ltr" class="client-nojs"><!-- Mirrored from en.cppreference.com/w/cpp/memory/shared_ptr by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:31:12 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->

<title>std::shared_ptr</title>
<meta charset="UTF-8">
<meta name="generator" content="MediaWiki 1.21.2">







<meta name="ResourceLoaderDynamicStyles" content="">

<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}#toc{display:none}.editsection{display:none}
/* cache key: mwiki1-mwiki_en_:resourceloader:filter:minify-css:7:472787eddcf4605d11de8c7ef047234f */</style>




<style type="text/css">/*<![CDATA[*/
.source-cpp {line-height: normal;}
.source-cpp li, .source-cpp pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp
 * CSS class: source-cpp, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp.source-cpp .de1, .cpp.source-cpp .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cpp.source-cpp  {font-family:monospace;}
.cpp.source-cpp .imp {font-weight: bold; color: red;}
.cpp.source-cpp li, .cpp.source-cpp .li1 {font-weight: normal; vertical-align:top;}
.cpp.source-cpp .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp.source-cpp .li2 {font-weight: bold; vertical-align:top;}
.cpp.source-cpp .kw1 {color: #0000dd;}
.cpp.source-cpp .kw2 {color: #0000ff;}
.cpp.source-cpp .kw3 {color: #0000dd;}
.cpp.source-cpp .kw4 {color: #0000ff;}
.cpp.source-cpp .co1 {color: #909090;}
.cpp.source-cpp .co2 {color: #339900;}
.cpp.source-cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp.source-cpp .es0 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es1 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es2 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es3 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es4 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es5 {color: #008000; font-weight: bold;}
.cpp.source-cpp .br0 {color: #008000;}
.cpp.source-cpp .sy0 {color: #008000;}
.cpp.source-cpp .sy1 {color: #000080;}
.cpp.source-cpp .sy2 {color: #000040;}
.cpp.source-cpp .sy3 {color: #000040;}
.cpp.source-cpp .sy4 {color: #008080;}
.cpp.source-cpp .st0 {color: #008000;}
.cpp.source-cpp .nu0 {color: #000080;}
.cpp.source-cpp .nu6 {color: #000080;}
.cpp.source-cpp .nu8 {color: #000080;}
.cpp.source-cpp .nu12 {color: #000080;}
.cpp.source-cpp .nu16 {color:#000080;}
.cpp.source-cpp .nu17 {color:#000080;}
.cpp.source-cpp .nu18 {color:#000080;}
.cpp.source-cpp .nu19 {color:#000080;}
.cpp.source-cpp .ln-xtra, .cpp.source-cpp li.ln-xtra, .cpp.source-cpp div.ln-xtra {background-color: #ffc;}
.cpp.source-cpp span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/mwiki/skins/cppreference2/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-cpp_memory_shared_ptr skin-cppreference2 action-view cpp-navbar">
        <!-- header -->
        
        <!-- /header -->
        <!-- content -->
<style type="text/css">
#carbonads {
  display: block;
  overflow: hidden;
  position: absolute;
  text-align: center;
  left: -170px;
  max-width: 150px;
  border-radius: 4px;
  border: solid 1px hsla(0, 0%, 0%, .1);
  background-color: hsl(0, 0%, 98%);
  font-size: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  display: block;
  margin-bottom: 8px;
  max-width: 150px;
  line-height: 1;
}

.carbon-img img {
  display: block;
  margin: 0 auto;
  max-width: 150px !important;
  width: 150px;
  height: auto;
}

.carbon-text {
  display: block;
  padding: 0 1em 8px;
}

.carbon-poweredby {
  display: block;
  padding: 8px 12px;
  background: repeating-linear-gradient(-45deg, transparent, transparent 5px, hsla(0, 0%, 0%, .025) 5px, hsla(0, 0%, 0%, .025) 10px) hsla(203, 11%, 95%, .4);
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 600;
  font-size: 9px;
  line-height: 1;
}
html { font-variant-ligatures: no-common-ligatures; }
</style>
        <div id="cpp-content-base">
            <div id="content">
                <a id="top"></a>
                <div id="mw-js-message" style="display:none;"></div>
                                <!-- firstHeading -->
<script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYITK7M&amp;placement=cppreferencecom" id="_carbonads_js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HW0LXMYCY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8HW0LXMYCY');
</script>
                <h1 id="firstHeading" class="firstHeading"><span style="font-size:0.7em; line-height:130%">std::</span>shared_ptr</h1>
                <!-- /firstHeading -->
                <!-- bodyContent -->
                <div id="bodyContent">
                                        <!-- tagline -->
                    
                    <!-- /tagline -->
                                        <!-- subtitle -->
                    
                    <!-- /subtitle -->
                                                            <!-- bodycontent -->
                    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<table class="t-dcl-begin"><tbody>
<tr class="t-dsc-header">
<td> <div>Defined in header <code><a href="../header/memory.html" title="cpp/header/memory">&lt;memory&gt;</a></code>
 </div></td>
<td></td>
<td></td>
</tr>
<tr class="t-dcl t-since-cxx11">
<td> <div><span class="mw-geshi cpp source-cpp"><span class="kw1">template</span><span class="sy1">&lt;</span> <span class="kw1">class</span> T <span class="sy1">&gt;</span> <span class="kw1">class</span> shared_ptr<span class="sy4">;</span></span></div></td>
<td class="t-dcl-nopad">  </td>
<td> <span class="t-mark-rev t-since-cxx11">(since C++11)</span> </td>
</tr>
<tr class="t-dcl-sep"><td></td><td></td><td></td></tr>
</tbody></table>
<p><code>std::shared_ptr</code> is a smart pointer that retains shared ownership of an object through a pointer. Several <code>shared_ptr</code> objects may own the same object. The object is destroyed and its memory deallocated when either of the following happens:
</p>
<ul><li> the last remaining <code>shared_ptr</code> owning the object is destroyed;
</li><li> the last remaining <code>shared_ptr</code> owning the object is assigned another pointer via <span class="t-lc"><a href="shared_ptr/operator%3d.html" title="cpp/memory/shared ptr/operator=">operator=</a></span> or <span class="t-lc"><a href="shared_ptr/reset.html" title="cpp/memory/shared ptr/reset">reset()</a></span>.
</li></ul>
<p>The object is destroyed using <a href="../language/delete.html" title="cpp/language/delete">delete-expression</a> or a custom deleter that is supplied to <code>shared_ptr</code> during construction.
</p><p>A <code>shared_ptr</code> can share ownership of an object while storing a pointer to another object. This feature can be used to point to member objects while owning the object they belong to. The stored pointer is the one accessed by <span class="t-lc"><a href="shared_ptr/get.html" title="cpp/memory/shared ptr/get">get()</a></span>, the dereference and the comparison operators. The managed pointer is the one passed to the deleter when use count reaches zero.
</p><p>A <code>shared_ptr</code> may also own no objects, in which case it is called <i>empty</i> (an empty <code>shared_ptr</code> may have a non-null stored pointer if the aliasing constructor was used to create it).
</p><p>All specializations of <code>shared_ptr</code> meet the requirements of <a href="../named_req/CopyConstructible.html" title="cpp/named req/CopyConstructible"><span style="font-family: Georgia, 'DejaVu Serif', serif; font-style:italic">CopyConstructible</span></a>, <a href="../named_req/CopyAssignable.html" title="cpp/named req/CopyAssignable"><span style="font-family: Georgia, 'DejaVu Serif', serif; font-style:italic">CopyAssignable</span></a>, and <a href="../named_req/LessThanComparable.html" title="cpp/named req/LessThanComparable"><span style="font-family: Georgia, 'DejaVu Serif', serif; font-style:italic">LessThanComparable</span></a> and are <a href="../language/implicit_conversion.html" title="cpp/language/implicit cast" class="mw-redirect">contextually convertible</a> to <code>bool</code>.
</p><p>All member functions (including copy constructor and copy assignment) can be called by multiple threads on different <code>shared_ptr</code> objects without additional synchronization even if these objects are copies and share ownership of the same object. If multiple threads of execution access the same <code>shared_ptr</code> object without synchronization and any of those accesses uses a non-const member function of <code>shared_ptr</code> then a data race will occur; the <a href="shared_ptr/atomic2.html" title="cpp/memory/shared ptr/atomic2"><tt>std::atomic&lt;shared_ptr&gt;</tt></a> can be used to prevent the data race.
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Member_types"><span class="tocnumber">1</span> <span class="toctext">Member types</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Member_functions"><span class="tocnumber">2</span> <span class="toctext">Member functions</span></a>
<ul>
<li class="toclevel-2"><a href="#Modifiers"><span class="tocnumber">2.1</span> <span class="toctext">Modifiers</span></a></li>
<li class="toclevel-2"><a href="#Observers"><span class="tocnumber">2.2</span> <span class="toctext">Observers</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Non-member_functions"><span class="tocnumber">3</span> <span class="toctext">Non-member functions</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Helper_classes"><span class="tocnumber">4</span> <span class="toctext">Helper classes</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Deduction_guides_.28since_C.2B.2B17.29"><span class="tocnumber">5</span> <span class="toctext">Deduction guides <span>(since C++17)</span></span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Notes"><span class="tocnumber">6</span> <span class="toctext">Notes</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Implementation_notes"><span class="tocnumber">7</span> <span class="toctext">Implementation notes</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Example"><span class="tocnumber">8</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Example_2"><span class="tocnumber">9</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#See_also"><span class="tocnumber">10</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=1" title="Edit section: Member types">edit</a>]</span> <span class="mw-headline" id="Member_types">Member types</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc-hitem">
<td> Member type
</td>
<td> Definition
</td></tr>


<tr class="t-dsc">
<td> <code>element_type</code>
</td>
<td> <table class="t-rev-begin">
<tbody><tr class="t-rev t-until-cxx17"><td><span class="mw-geshi cpp source-cpp">T</span></td>
<td><span class="t-mark-rev t-until-cxx17">(until C++17)</span></td></tr>
<tr class="t-rev t-since-cxx17"><td><span class="mw-geshi cpp source-cpp"><a href="../types/remove_extent.html"><span class="kw626">std::<span class="me2">remove_extent_t</span></span></a><span class="sy1">&lt;</span>T<span class="sy1">&gt;</span></span></td>
<td><span class="t-mark-rev t-since-cxx17">(since C++17)</span></td></tr>
</tbody></table>
</td></tr>


<tr class="t-dsc">
<td> <code>weak_type</code> <span class="t-mark-rev t-since-cxx17">(since C++17)</span>
</td>
<td> <span class="mw-geshi cpp source-cpp"><a href="weak_ptr.html"><span class="kw744">std::<span class="me2">weak_ptr</span></span></a><span class="sy1">&lt;</span>T<span class="sy1">&gt;</span></span>
</td></tr>

</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=2" title="Edit section: Member functions">edit</a>]</span> <span class="mw-headline" id="Member_functions">Member functions</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div t-dsc-member-nobold-div"><div><a href="shared_ptr/shared_ptr.html" title="cpp/memory/shared ptr/shared ptr"> <span class="t-lines"><span>(constructor)</span></span></a></div></div>
</td>
<td>  constructs new <code>shared_ptr</code> <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_constructor&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div t-dsc-member-nobold-div"><div><a href="shared_ptr/_shared_ptr.html" title="cpp/memory/shared ptr/~shared ptr"> <span class="t-lines"><span>(destructor)</span></span></a></div></div>
</td>
<td>  destructs the owned object if no more <code>shared_ptr</code>s link to it <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_destructor&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator%3d.html" title="cpp/memory/shared ptr/operator="> <span class="t-lines"><span>operator=</span></span></a></div></div>
</td>
<td>  assigns the <code>shared_ptr</code> <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator%3D&amp;action=edit">[edit]</a></span>
</td></tr>


<tr>
<td colspan="2"> <h5> <span class="mw-headline" id="Modifiers"> Modifiers </span></h5>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/reset.html" title="cpp/memory/shared ptr/reset"> <span class="t-lines"><span>reset</span></span></a></div></div>
</td>
<td>  replaces the managed object <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_reset&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/swap.html" title="cpp/memory/shared ptr/swap"> <span class="t-lines"><span>swap</span></span></a></div></div>
</td>
<td>  swaps the managed objects <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_swap&amp;action=edit">[edit]</a></span>
</td></tr>


<tr>
<td colspan="2"> <h5> <span class="mw-headline" id="Observers"> Observers </span></h5>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/get.html" title="cpp/memory/shared ptr/get"> <span class="t-lines"><span>get</span></span></a></div></div>
</td>
<td>  returns the stored pointer <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_get&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator_.html" title="cpp/memory/shared ptr/operator*"> <span class="t-lines"><span>operator*</span><span>operator-&gt;</span></span></a></div></div>
</td>
<td>  dereferences the stored pointer <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator*&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator_at.html" title="cpp/memory/shared ptr/operator at"> <span class="t-lines"><span>operator[]</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx17">(C++17)</span></span></span></div></div>
</td>
<td>  provides indexed access to the stored array <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator_at&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/use_count.html" title="cpp/memory/shared ptr/use count"> <span class="t-lines"><span>use_count</span></span></a></div></div>
</td>
<td>  returns the number of <code>shared_ptr</code> objects referring to the same managed object <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_use_count&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/unique.html" title="cpp/memory/shared ptr/unique"> <span class="t-lines"><span>unique</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-until-cxx20">(until C++20)</span></span></span></div></div>
</td>
<td>  checks whether the managed object is managed only by the current <code>shared_ptr</code> object <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_unique&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator_bool.html" title="cpp/memory/shared ptr/operator bool"> <span class="t-lines"><span>operator bool</span></span></a></div></div>
</td>
<td>  checks if the stored pointer is not null <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator_bool&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/owner_before.html" title="cpp/memory/shared ptr/owner before"> <span class="t-lines"><span>owner_before</span></span></a></div></div>
</td>
<td>  provides owner-based ordering of shared pointers <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_owner_before&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/owner_hash.html" title="cpp/memory/shared ptr/owner hash"> <span class="t-lines"><span>owner_hash</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx26">(C++26)</span></span></span></div></div>
</td>
<td>  provides owner-based hashing of shared pointers <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_owner_hash&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/owner_equal.html" title="cpp/memory/shared ptr/owner equal"> <span class="t-lines"><span>owner_equal</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx26">(C++26)</span></span></span></div></div>
</td>
<td>  provides owner-based equal comparison of shared pointers <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_owner_equal&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=3" title="Edit section: Non-member functions">edit</a>]</span> <span class="mw-headline" id="Non-member_functions">Non-member functions</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/make_shared.html" title="cpp/memory/shared ptr/make shared"> <span class="t-lines"><span>make_shared</span><span>make_shared_for_overwrite</span></span></a></div><div><span class="t-lines"><span></span><span><span class="t-mark-rev t-since-cxx20">(C++20)</span></span></span></div></div>
</td>
<td>  creates a shared pointer that manages a new object <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_make_shared&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/allocate_shared.html" title="cpp/memory/shared ptr/allocate shared"> <span class="t-lines"><span>allocate_shared</span><span>allocate_shared_for_overwrite</span></span></a></div><div><span class="t-lines"><span></span><span><span class="t-mark-rev t-since-cxx20">(C++20)</span></span></span></div></div>
</td>
<td>  creates a shared pointer that manages a new object allocated using an allocator <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_allocate_shared&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/pointer_cast.html" title="cpp/memory/shared ptr/pointer cast"> <span class="t-lines"><span>static_pointer_cast</span><span>dynamic_pointer_cast</span><span>const_pointer_cast</span><span>reinterpret_pointer_cast</span></span></a></div><div><span class="t-lines"><span></span><span></span><span></span><span><span class="t-mark-rev t-since-cxx17">(C++17)</span></span></span></div></div>
</td>
<td>  applies <a href="../language/static_cast.html" title="cpp/language/static cast"><tt>static_cast</tt></a>, <a href="../language/dynamic_cast.html" title="cpp/language/dynamic cast"><tt>dynamic_cast</tt></a>, <a href="../language/const_cast.html" title="cpp/language/const cast"><tt>const_cast</tt></a>, or <a href="../language/reinterpret_cast.html" title="cpp/language/reinterpret cast"><tt>reinterpret_cast</tt></a> to the stored pointer <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_pointer_cast&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/get_deleter.html" title="cpp/memory/shared ptr/get deleter"> <span class="t-lines"><span>get_deleter</span></span></a></div></div>
</td>
<td>  returns the deleter of specified type, if owned <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_get_deleter&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator_cmp.html" title="cpp/memory/shared ptr/operator cmp"> <span class="t-lines"><span>operator==</span><span>operator!=</span><span>operator&lt;</span><span>operator&lt;=</span><span>operator&gt;</span><span>operator&gt;=</span><span>operator&lt;=&gt;</span></span></a></div><div><span class="t-lines"><span></span><span><span class="t-mark-rev t-until-cxx20">(removed in C++20)</span></span><span><span class="t-mark-rev t-until-cxx20">(removed in C++20)</span></span><span><span class="t-mark-rev t-until-cxx20">(removed in C++20)</span></span><span><span class="t-mark-rev t-until-cxx20">(removed in C++20)</span></span><span><span class="t-mark-rev t-until-cxx20">(removed in C++20)</span></span><span><span class="t-mark-rev t-since-cxx20">(C++20)</span></span></span></div></div>
</td>
<td>  compares with another <code>shared_ptr</code> or with <span class="t-c"><span class="mw-geshi cpp source-cpp">nullptr</span></span> <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator_cmp&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/operator_ltlt.html" title="cpp/memory/shared ptr/operator ltlt"> <span class="t-lines"><span>operator&lt;&lt;<span class="t-dsc-small">(std::shared_ptr)</span></span></span></a></div></div>
</td>
<td>  outputs the value of the stored pointer to an output stream <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_operator_ltlt&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/swap2.html" title="cpp/memory/shared ptr/swap2"> <span class="t-lines"><span>std::swap<span class="t-dsc-small">(std::shared_ptr)</span></span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  specializes the <span class="t-lc"><a href="../algorithm/swap.html" title="cpp/algorithm/swap">std::swap</a></span> algorithm <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_swap2&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>
<table class="t-dsc-begin">


<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/atomic.html" title="cpp/memory/shared ptr/atomic"> <span class="t-lines"><span>std::atomic_is_lock_free<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_load<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_load_explicit<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_store<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_store_explicit<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_exchange<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_exchange_explicit<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_compare_exchange_weak<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_compare_exchange_strong<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_compare_exchange_weak_explicit<span class="t-dsc-small">(std::shared_ptr)</span></span><span>std::atomic_compare_exchange_strong_explicit<span class="t-dsc-small">(std::shared_ptr)</span></span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-deprecated-cxx20">(deprecated in C++20)</span></span><span><span class="t-mark-rev t-until-cxx26">(removed in C++26)</span></span></span></div></div>
</td>
<td>  specializes atomic operations for <code>std::shared_ptr</code> <br> <span class="t-mark">(function template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_atomic&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=4" title="Edit section: Helper classes">edit</a>]</span> <span class="mw-headline" id="Helper_classes">Helper classes</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/atomic2.html" title="cpp/memory/shared ptr/atomic2"> <span class="t-lines"><span>std::atomic<span class="t-dsc-small">&lt;std::shared_ptr&gt;</span></span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx20">(C++20)</span></span></span></div></div>
</td>
<td>  atomic shared pointer <br> <span class="t-mark">(class template specialization)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_atomic2&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="shared_ptr/hash.html" title="cpp/memory/shared ptr/hash"> <span class="t-lines"><span>std::hash<span class="t-dsc-small">&lt;std::shared_ptr&gt;</span></span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  hash support for <strong class="selflink"><tt>std::shared_ptr</tt></strong> <br> <span class="t-mark">(class template specialization)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/shared_ptr/dsc_hash&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=5" title="Edit section: Deduction guides (since C++17)">edit</a>]</span> <span class="mw-headline" id="Deduction_guides_.28since_C.2B.2B17.29"><a href="shared_ptr/deduction_guides.html" title="cpp/memory/shared ptr/deduction guides">Deduction guides</a> <span class="t-mark-rev t-since-cxx17">(since C++17)</span></span></h3>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=6" title="Edit section: Notes">edit</a>]</span> <span class="mw-headline" id="Notes">Notes</span></h3>
<p>The ownership of an object can only be shared with another <code>shared_ptr</code> by copy constructing or copy assigning its value to another <code>shared_ptr</code>. Constructing a new <code>shared_ptr</code> using the raw underlying pointer owned by another <code>shared_ptr</code> leads to undefined behavior.
</p><p><code>std::shared_ptr</code> may be used with an <a href="../language/type%23Incomplete_type.html" title="cpp/language/incomplete type" class="mw-redirect">incomplete type</a> <code>T</code>. However, the constructor from a raw pointer (<span class="t-c"><span class="mw-geshi cpp source-cpp"><span class="kw1">template</span><span class="sy1">&lt;</span><span class="kw1">class</span> Y<span class="sy1">&gt;</span> shared_ptr<span class="br0">(</span>Y<span class="sy2">*</span><span class="br0">)</span></span></span>) and the <span class="t-c"><span class="mw-geshi cpp source-cpp"><span class="kw1">template</span><span class="sy1">&lt;</span><span class="kw1">class</span> Y<span class="sy1">&gt;</span> <span class="kw4">void</span> reset<span class="br0">(</span>Y<span class="sy2">*</span><span class="br0">)</span></span></span> member function may only be called with a pointer to a complete type (note that <span class="t-lc"><a href="unique_ptr.html" title="cpp/memory/unique ptr">std::unique_ptr</a></span> may be constructed from a raw pointer to an incomplete type).
</p><p>The <code>T</code> in <span class="mw-geshi cpp source-cpp">std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>T<span class="sy1">&gt;</span></span> may be a function type: in this case it manages a pointer to function, rather than an object pointer. This is sometimes used to keep a dynamic library or a plugin loaded as long as any of its functions are referenced:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="kw4">void</span> del<span class="br0">(</span><span class="kw4">void</span><span class="br0">(</span><span class="sy2">*</span><span class="br0">)</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> fun<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span><span class="kw4">void</span><span class="br0">(</span><span class="br0">)</span><span class="sy1">&gt;</span> ee<span class="br0">(</span>fun, del<span class="br0">)</span><span class="sy4">;</span>
    <span class="br0">(</span><span class="sy2">*</span>ee<span class="br0">)</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=7" title="Edit section: Implementation notes">edit</a>]</span> <span class="mw-headline" id="Implementation_notes">Implementation notes</span></h3>
<p>In a typical implementation, <code>shared_ptr</code> holds only two pointers:
</p>
<ul><li> the stored pointer (one returned by <span class="t-lc"><a href="shared_ptr/get.html" title="cpp/memory/shared ptr/get">get()</a></span>);
</li><li> a pointer to <i>control block</i>.
</li></ul>
<p>The control block is a dynamically-allocated object that holds:
</p>
<ul><li> either a pointer to the managed object or the managed object itself;
</li><li> the deleter (type-erased);
</li><li> the allocator (type-erased);
</li><li> the number of <code>shared_ptr</code>s that own the managed object;
</li><li> the number of <code>weak_ptr</code>s that refer to the managed object.
</li></ul>
<p>When <code>shared_ptr</code> is created by calling <span class="t-lc"><a href="shared_ptr/make_shared.html" title="cpp/memory/shared ptr/make shared">std::make_shared</a></span> or <span class="t-lc"><a href="shared_ptr/allocate_shared.html" title="cpp/memory/shared ptr/allocate shared">std::allocate_shared</a></span>, the memory for both the control block and the managed object is created with a single allocation. The managed object is constructed in-place in a data member of the control block. When <code>shared_ptr</code> is created via one of the <code>shared_ptr</code> constructors, the managed object and the control block must be allocated separately. In this case, the control block stores a pointer to the managed object.
</p><p>The pointer held by the <code>shared_ptr</code> directly is the one returned by <span class="t-lc"><a href="shared_ptr/get.html" title="cpp/memory/shared ptr/get">get()</a></span>, while the pointer/object held by the control block is the one that will be deleted when the number of shared owners reaches zero. These pointers are not necessarily equal.
</p><p>The destructor of <code>shared_ptr</code> decrements the number of shared owners of the control block. If that counter reaches zero, the control block calls the destructor of the managed object. The control block does not deallocate itself until the <span class="t-lc"><a href="weak_ptr.html" title="cpp/memory/weak ptr">std::weak_ptr</a></span> counter reaches zero as well.
</p><p>In existing implementations, the number of weak pointers is incremented (<a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/questions/43297517/stdshared-ptr-internals-weak-count-more-than-expected">[1]</a>, <a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/cpp/comments/3eia29/stdshared_ptrs_secret_constructor/ctfeh1p">[2]</a>) if there is a shared pointer to the same control block.
</p><p>To satisfy thread safety requirements, the reference counters are typically incremented using an equivalent of <span class="t-lc"><a href="../atomic/atomic/fetch_add.html" title="cpp/atomic/atomic/fetch add">std::atomic::fetch_add</a></span> with <span class="t-lc"><a href="../atomic/memory_order.html" title="cpp/atomic/memory order">std::memory_order_relaxed</a></span> (decrementing requires stronger ordering to safely destroy the control block).
</p>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=8" title="Edit section: Example">edit</a>]</span> <span class="mw-headline" id="Example">Example</span></h3>
<div class="t-example"><div class="t-example-live-link"><div class="coliru-btn coliru-btn-run-init">Run this code</div></div>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="co2">#include &lt;chrono&gt;</span>
<span class="co2">#include &lt;iostream&gt;</span>
<span class="co2">#include &lt;memory&gt;</span>
<span class="co2">#include &lt;mutex&gt;</span>
<span class="co2">#include &lt;thread&gt;</span>
&nbsp;
<span class="kw1">using</span> <span class="kw1">namespace</span> std<span class="sy4">::</span><span class="me2">chrono_literals</span><span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> Base
<span class="br0">{</span>
    Base<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Base::Base()<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
&nbsp;
    <span class="co1">// Note: non-virtual destructor is OK here</span>
    ~Base<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Base::~Base()<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> Derived <span class="sy4">:</span> <span class="kw1">public</span> Base
<span class="br0">{</span>
    Derived<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Derived::Derived()<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
&nbsp;
    ~Derived<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Derived::~Derived()<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> print<span class="br0">(</span><span class="kw4">auto</span> rem, std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Base<span class="sy1">&gt;</span> <span class="kw4">const</span><span class="sy3">&amp;</span> sp<span class="br0">)</span>
<span class="br0">{</span>
    <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> rem <span class="sy1">&lt;&lt;</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\t</span>get() = "</span> <span class="sy1">&lt;&lt;</span> sp.<span class="me1">get</span><span class="br0">(</span><span class="br0">)</span>
              <span class="sy1">&lt;&lt;</span> <span class="st0">", use_count() = "</span> <span class="sy1">&lt;&lt;</span> sp.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> thr<span class="br0">(</span>std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Base<span class="sy1">&gt;</span> p<span class="br0">)</span>
<span class="br0">{</span>
    <a href="../thread/sleep_for.html"><span class="kw2169">std::<span class="me2">this_thread</span><span class="sy4">::</span><span class="me2">sleep_for</span></span></a><span class="br0">(</span>987ms<span class="br0">)</span><span class="sy4">;</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Base<span class="sy1">&gt;</span> lp <span class="sy1">=</span> p<span class="sy4">;</span> <span class="co1">// thread-safe, even though the</span>
                                  <span class="co1">// shared use_count is incremented</span>
    <span class="br0">{</span>
        <span class="kw4">static</span> <a href="../thread/mutex.html"><span class="kw2174">std::<span class="me2">mutex</span></span></a> io_mutex<span class="sy4">;</span>
        <a href="../thread/lock_guard.html"><span class="kw2186">std::<span class="me2">lock_guard</span></span></a><span class="sy1">&lt;</span><a href="../thread/mutex.html"><span class="kw2174">std::<span class="me2">mutex</span></span></a><span class="sy1">&gt;</span> lk<span class="br0">(</span>io_mutex<span class="br0">)</span><span class="sy4">;</span>
        print<span class="br0">(</span><span class="st0">"Local pointer in a thread:"</span>, lp<span class="br0">)</span><span class="sy4">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Base<span class="sy1">&gt;</span> p <span class="sy1">=</span> <a href="shared_ptr/make_shared.html"><span class="kw739">std::<span class="me2">make_shared</span></span></a><span class="sy1">&lt;</span>Derived<span class="sy1">&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    print<span class="br0">(</span><span class="st0">"Created a shared Derived (as a pointer to Base)"</span>, p<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <a href="../thread/thread.html"><span class="kw2166">std::<span class="me2">thread</span></span></a> t1<span class="br0">{</span>thr, p<span class="br0">}</span>, t2<span class="br0">{</span>thr, p<span class="br0">}</span>, t3<span class="br0">{</span>thr, p<span class="br0">}</span><span class="sy4">;</span>
    p.<span class="me1">reset</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> <span class="co1">// release ownership from main</span>
&nbsp;
    print<span class="br0">(</span><span class="st0">"Shared ownership between 3 threads and released ownership from main:"</span>, p<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    t1.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    t2.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    t3.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"All threads completed, the last one deleted Derived.<span class="es1">\n</span>"</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<p>Possible output:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="text source-text"><pre class="de1">Base::Base()
Derived::Derived()
Created a shared Derived (as a pointer to Base)
	get() = 0x118ac30, use_count() = 1
Shared ownership between 3 threads and released ownership from main:
	get() = 0, use_count() = 0
Local pointer in a thread:
	get() = 0x118ac30, use_count() = 5
Local pointer in a thread:
	get() = 0x118ac30, use_count() = 4
Local pointer in a thread:
	get() = 0x118ac30, use_count() = 2
Derived::~Derived()
Base::~Base()
All threads completed, the last one deleted Derived.</pre></div></div> 
</div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=9" title="Edit section: Example">edit</a>]</span> <span class="mw-headline" id="Example_2">Example</span></h3>
<div class="t-example"><div class="t-example-live-link"><div class="coliru-btn coliru-btn-run-init">Run this code</div></div>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="co2">#include &lt;iostream&gt;</span>
<span class="co2">#include &lt;memory&gt;</span>
&nbsp;
<span class="kw1">struct</span> MyObj
<span class="br0">{</span>
    MyObj<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"MyObj constructed<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
&nbsp;
    ~MyObj<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <a href="../io/cout.html"><span class="kw1774">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"MyObj destructed<span class="es1">\n</span>"</span><span class="sy4">;</span> <span class="br0">}</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> Container <span class="sy4">:</span> <a href="enable_shared_from_this.html"><span class="kw747">std::<span class="me2">enable_shared_from_this</span></span></a><span class="sy1">&lt;</span>Container<span class="sy1">&gt;</span> <span class="co1">// note: public inheritance</span>
<span class="br0">{</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span> memberObj<span class="sy4">;</span>
&nbsp;
    <span class="kw4">void</span> CreateMember<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> memberObj <span class="sy1">=</span> <a href="shared_ptr/make_shared.html"><span class="kw739">std::<span class="me2">make_shared</span></span></a><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> <span class="br0">}</span>
&nbsp;
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span> GetAsMyObj<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="co1">// Use an alias shared ptr for member</span>
        <span class="kw1">return</span> std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span><span class="br0">(</span>shared_from_this<span class="br0">(</span><span class="br0">)</span>, memberObj.<span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    <span class="br0">}</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="co2">#define COUT(str) std::cout &lt;&lt; '\n' &lt;&lt; str &lt;&lt; '\n'</span>
&nbsp;
<span class="co2">#define DEMO(...) std::cout &lt;&lt; #__VA_ARGS__ &lt;&lt; " = " &lt;&lt; __VA_ARGS__ &lt;&lt; '\n'</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    COUT<span class="br0">(</span><span class="st0">"Creating shared container"</span><span class="br0">)</span><span class="sy4">;</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Container<span class="sy1">&gt;</span> cont <span class="sy1">=</span> <a href="shared_ptr/make_shared.html"><span class="kw739">std::<span class="me2">make_shared</span></span></a><span class="sy1">&lt;</span>Container<span class="sy1">&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Creating member"</span><span class="br0">)</span><span class="sy4">;</span>
    cont<span class="sy2">-</span><span class="sy1">&gt;</span>CreateMember<span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Creating another shared container"</span><span class="br0">)</span><span class="sy4">;</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>Container<span class="sy1">&gt;</span> cont2 <span class="sy1">=</span> cont<span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"GetAsMyObj"</span><span class="br0">)</span><span class="sy4">;</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span> myobj1 <span class="sy1">=</span> cont<span class="sy2">-</span><span class="sy1">&gt;</span>GetAsMyObj<span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj1.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Copying alias obj"</span><span class="br0">)</span><span class="sy4">;</span>
    std<span class="sy4">::</span><span class="me2">shared_ptr</span><span class="sy1">&lt;</span>MyObj<span class="sy1">&gt;</span> myobj2 <span class="sy1">=</span> myobj1<span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj1.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj2.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont2<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Resetting cont2"</span><span class="br0">)</span><span class="sy4">;</span>
    cont2.<span class="me1">reset</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj1.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj2.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Resetting myobj2"</span><span class="br0">)</span><span class="sy4">;</span>
    myobj2.<span class="me1">reset</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj1.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont<span class="sy2">-</span><span class="sy1">&gt;</span>memberObj.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    COUT<span class="br0">(</span><span class="st0">"Resetting cont"</span><span class="br0">)</span><span class="sy4">;</span>
    cont.<span class="me1">reset</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>myobj1.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    DEMO<span class="br0">(</span>cont.<span class="me1">use_count</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<p>Output:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="text source-text"><pre class="de1">Creating shared container
cont.use_count() = 1
cont-&gt;memberObj.use_count() = 0
&nbsp;
Creating member
MyObj constructed
cont.use_count() = 1
cont-&gt;memberObj.use_count() = 1
&nbsp;
Creating another shared container
cont.use_count() = 2
cont-&gt;memberObj.use_count() = 1
cont2.use_count() = 2
cont2-&gt;memberObj.use_count() = 1
&nbsp;
GetAsMyObj
myobj1.use_count() = 3
cont.use_count() = 3
cont-&gt;memberObj.use_count() = 1
cont2.use_count() = 3
cont2-&gt;memberObj.use_count() = 1
&nbsp;
Copying alias obj
myobj1.use_count() = 4
myobj2.use_count() = 4
cont.use_count() = 4
cont-&gt;memberObj.use_count() = 1
cont2.use_count() = 4
cont2-&gt;memberObj.use_count() = 1
&nbsp;
Resetting cont2
myobj1.use_count() = 3
myobj2.use_count() = 3
cont.use_count() = 3
cont-&gt;memberObj.use_count() = 1
&nbsp;
Resetting myobj2
myobj1.use_count() = 2
cont.use_count() = 2
cont-&gt;memberObj.use_count() = 1
&nbsp;
Resetting cont
myobj1.use_count() = 1
cont.use_count() = 0
MyObj destructed</pre></div></div> 
</div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;action=edit&amp;section=10" title="Edit section: See also">edit</a>]</span> <span class="mw-headline" id="See_also">See also</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="unique_ptr.html" title="cpp/memory/unique ptr"> <span class="t-lines"><span>unique_ptr</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  smart pointer with unique object ownership semantics <br> <span class="t-mark">(class template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/dsc_unique_ptr&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="weak_ptr.html" title="cpp/memory/weak ptr"> <span class="t-lines"><span>weak_ptr</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  weak reference to an object managed by <span class="t-lc"><strong class="selflink">std::shared_ptr</strong></span> <br> <span class="t-mark">(class template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/memory/dsc_weak_ptr&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>

<!-- 
NewPP limit report
Preprocessor visited node count: 14756/1000000
Preprocessor generated node count: 17420/1000000
Postexpand include size: 498726/4194304 bytes
Template argument size: 118809/4194304 bytes
Highest expansion depth: 25/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:2177-0!*!0!!en!*!* and timestamp 20250113083532 -->
</div>                    <!-- /bodycontent -->
                                        <!-- printfooter -->
                    <div class="printfooter">
                    Retrieved from "<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;oldid=173514">https://en.cppreference.com/mwiki/index.php?title=cpp/memory/shared_ptr&amp;oldid=173514</a>"                    </div>
                    <!-- /printfooter -->
                                                            <!-- catlinks -->
                    <div id="catlinks" class="catlinks catlinks-allhidden"></div>                    <!-- /catlinks -->
                                                            <div class="visualClear"></div>
                    <!-- debughtml -->
                                        <!-- /debughtml -->
                </div>
                <!-- /bodyContent -->
            </div>
        </div>
        <!-- /content -->
        <!-- footer -->
        
        <!-- /footer -->
        <script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=skins.cppreference2&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi","ext.gadget.ColiruCompiler","ext.gadget.StandardRevisions","ext.gadget.MathJax"], null, true);
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<!-- Served in 2.904 secs. -->
	




</body><!-- Cached 20250113083532 --><!-- Mirrored from en.cppreference.com/w/cpp/memory/shared_ptr by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:31:18 GMT --></html>