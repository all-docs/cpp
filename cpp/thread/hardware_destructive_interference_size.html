<!DOCTYPE html><html lang="en" dir="ltr" class="client-nojs"><!-- Mirrored from en.cppreference.com/w/cpp/thread/hardware_destructive_interference_size by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:37:18 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->

<title>std::hardware_destructive_interference_size, std::hardware_constructive_interference_size</title>
<meta charset="UTF-8">
<meta name="generator" content="MediaWiki 1.21.2">







<meta name="ResourceLoaderDynamicStyles" content="">

<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}#toc{display:none}.editsection{display:none}
/* cache key: mwiki1-mwiki_en_:resourceloader:filter:minify-css:7:472787eddcf4605d11de8c7ef047234f */</style>




<style type="text/css">/*<![CDATA[*/
.source-cpp {line-height: normal;}
.source-cpp li, .source-cpp pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp
 * CSS class: source-cpp, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp.source-cpp .de1, .cpp.source-cpp .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cpp.source-cpp  {font-family:monospace;}
.cpp.source-cpp .imp {font-weight: bold; color: red;}
.cpp.source-cpp li, .cpp.source-cpp .li1 {font-weight: normal; vertical-align:top;}
.cpp.source-cpp .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp.source-cpp .li2 {font-weight: bold; vertical-align:top;}
.cpp.source-cpp .kw1 {color: #0000dd;}
.cpp.source-cpp .kw2 {color: #0000ff;}
.cpp.source-cpp .kw3 {color: #0000dd;}
.cpp.source-cpp .kw4 {color: #0000ff;}
.cpp.source-cpp .co1 {color: #909090;}
.cpp.source-cpp .co2 {color: #339900;}
.cpp.source-cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp.source-cpp .es0 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es1 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es2 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es3 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es4 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es5 {color: #008000; font-weight: bold;}
.cpp.source-cpp .br0 {color: #008000;}
.cpp.source-cpp .sy0 {color: #008000;}
.cpp.source-cpp .sy1 {color: #000080;}
.cpp.source-cpp .sy2 {color: #000040;}
.cpp.source-cpp .sy3 {color: #000040;}
.cpp.source-cpp .sy4 {color: #008080;}
.cpp.source-cpp .st0 {color: #008000;}
.cpp.source-cpp .nu0 {color: #000080;}
.cpp.source-cpp .nu6 {color: #000080;}
.cpp.source-cpp .nu8 {color: #000080;}
.cpp.source-cpp .nu12 {color: #000080;}
.cpp.source-cpp .nu16 {color:#000080;}
.cpp.source-cpp .nu17 {color:#000080;}
.cpp.source-cpp .nu18 {color:#000080;}
.cpp.source-cpp .nu19 {color:#000080;}
.cpp.source-cpp .ln-xtra, .cpp.source-cpp li.ln-xtra, .cpp.source-cpp div.ln-xtra {background-color: #ffc;}
.cpp.source-cpp span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/mwiki/skins/cppreference2/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-cpp_thread_hardware_destructive_interference_size skin-cppreference2 action-view cpp-navbar">
        <!-- header -->
        
        <!-- /header -->
        <!-- content -->
<style type="text/css">
#carbonads {
  display: block;
  overflow: hidden;
  position: absolute;
  text-align: center;
  left: -170px;
  max-width: 150px;
  border-radius: 4px;
  border: solid 1px hsla(0, 0%, 0%, .1);
  background-color: hsl(0, 0%, 98%);
  font-size: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  display: block;
  margin-bottom: 8px;
  max-width: 150px;
  line-height: 1;
}

.carbon-img img {
  display: block;
  margin: 0 auto;
  max-width: 150px !important;
  width: 150px;
  height: auto;
}

.carbon-text {
  display: block;
  padding: 0 1em 8px;
}

.carbon-poweredby {
  display: block;
  padding: 8px 12px;
  background: repeating-linear-gradient(-45deg, transparent, transparent 5px, hsla(0, 0%, 0%, .025) 5px, hsla(0, 0%, 0%, .025) 10px) hsla(203, 11%, 95%, .4);
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 600;
  font-size: 9px;
  line-height: 1;
}
html { font-variant-ligatures: no-common-ligatures; }
</style>
        <div id="cpp-content-base">
            <div id="content">
                <a id="top"></a>
                <div id="mw-js-message" style="display:none;"></div>
                                <!-- firstHeading -->
<script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYITK7M&amp;placement=cppreferencecom" id="_carbonads_js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HW0LXMYCY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8HW0LXMYCY');
</script>
                <h1 id="firstHeading" class="firstHeading"><span style="font-size:0.7em; line-height:130%">std::</span>hardware_destructive_interference_size, <span style="font-size:0.7em; line-height:130%">std::</span>hardware_constructive_interference_size</h1>
                <!-- /firstHeading -->
                <!-- bodyContent -->
                <div id="bodyContent">
                                        <!-- tagline -->
                    
                    <!-- /tagline -->
                                        <!-- subtitle -->
                    
                    <!-- /subtitle -->
                                                            <!-- bodycontent -->
                    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<table class="t-dcl-begin"><tbody>
<tr class="t-dsc-header">
<td> <div>Defined in header <code><a href="../header/new.html" title="cpp/header/new">&lt;new&gt;</a></code>
 </div></td>
<td></td>
<td></td>
</tr>
<tr class="t-dcl t-since-cxx17">
<td> <div><span class="mw-geshi cpp source-cpp"><span class="kw1">inline</span> <span class="kw4">constexpr</span> <a href="../types/size_t.html"><span class="kw107">std::<span class="me2">size_t</span></span></a><br>
&nbsp; &nbsp; hardware_destructive_interference_size <span class="sy1">=</span> <span class="coMULTI">/*implementation-defined*/</span><span class="sy4">;</span></span></div></td>
<td> (1) </td>
<td> <span class="t-mark-rev t-since-cxx17">(since C++17)</span> </td>
</tr>
<tr class="t-dcl t-since-cxx17">
<td> <div><span class="mw-geshi cpp source-cpp"><span class="kw1">inline</span> <span class="kw4">constexpr</span> <a href="../types/size_t.html"><span class="kw107">std::<span class="me2">size_t</span></span></a><br>
&nbsp; &nbsp; hardware_constructive_interference_size <span class="sy1">=</span> <span class="coMULTI">/*implementation-defined*/</span><span class="sy4">;</span></span></div></td>
<td> (2) </td>
<td> <span class="t-mark-rev t-since-cxx17">(since C++17)</span> </td>
</tr>
<tr class="t-dcl-sep"><td></td><td></td><td></td></tr>
</tbody></table>
<div class="t-li1"><span class="t-li">1)</span> Minimum offset between two objects to avoid false sharing. Guaranteed to be at least <span class="t-c"><span class="mw-geshi cpp source-cpp">alignof<span class="br0">(</span><a href="../types/max_align_t.html"><span class="kw111">std::<span class="me2">max_align_t</span></span></a><span class="br0">)</span></span></span>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="kw1">struct</span> keep_apart
<span class="br0">{</span>
    alignas<span class="br0">(</span>std<span class="sy4">::</span><span class="me2">hardware_destructive_interference_size</span><span class="br0">)</span> <a href="../atomic/atomic.html"><span class="kw2083">std::<span class="me2">atomic</span></span></a><span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> cat<span class="sy4">;</span>
    alignas<span class="br0">(</span>std<span class="sy4">::</span><span class="me2">hardware_destructive_interference_size</span><span class="br0">)</span> <a href="../atomic/atomic.html"><span class="kw2083">std::<span class="me2">atomic</span></span></a><span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> dog<span class="sy4">;</span>
<span class="br0">}</span><span class="sy4">;</span></pre></div></div></div>
<div class="t-li1"><span class="t-li">2)</span> Maximum size of contiguous memory to promote true sharing. Guaranteed to be at least <span class="t-c"><span class="mw-geshi cpp source-cpp">alignof<span class="br0">(</span><a href="../types/max_align_t.html"><span class="kw111">std::<span class="me2">max_align_t</span></span></a><span class="br0">)</span></span></span>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="kw1">struct</span> together
<span class="br0">{</span>
    <a href="../atomic/atomic.html"><span class="kw2083">std::<span class="me2">atomic</span></span></a><span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> dog<span class="sy4">;</span>
    <span class="kw4">int</span> puppy<span class="sy4">;</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> kennel
<span class="br0">{</span>
    <span class="co1">// Other data members...</span>
&nbsp;
    alignas<span class="br0">(</span>sizeof<span class="br0">(</span>together<span class="br0">)</span><span class="br0">)</span> together pack<span class="sy4">;</span>
&nbsp;
    <span class="co1">// Other data members...</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
static_assert<span class="br0">(</span>sizeof<span class="br0">(</span>together<span class="br0">)</span> <span class="sy1">&lt;=</span> std<span class="sy4">::</span><span class="me2">hardware_constructive_interference_size</span><span class="br0">)</span><span class="sy4">;</span></pre></div></div></div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/hardware_destructive_interference_size&amp;action=edit&amp;section=1" title="Edit section: Notes">edit</a>]</span> <span class="mw-headline" id="Notes">Notes</span></h3>
<p>These constants provide a portable way to access the L1 data cache line size.
</p>
<table class="wikitable ftm-begin ftm-has-value">

<tbody><tr>
<th><a href="../utility/feature_test.html" title="cpp/utility/feature test">Feature-test</a> macro</th>
<th><abbr title="The year/month in which the feature was adopted. The hyperlink under each value opens a compiler support page with entry for given feature.">Value</abbr></th>
<th><abbr title="Standard in which the feature is introduced; DR means defect report against that revision">Std</abbr></th>
<th>Feature
</th></tr>
<tr>
<td><a href="../feature_test.html#cpp_lib_hardware_interference_size" title="cpp/feature test"><code>__cpp_lib_hardware_interference_size</code></a></td>
<td><a href="../compiler_support/17.html#cpp_lib_hardware_interference_size_201703L" title="cpp/compiler support/17"><code>201703L</code></a></td>
<td><span class="t-mark">(C++17)</span></td>
<td><span class="mw-geshi cpp source-cpp"><span class="kw4">constexpr</span> std<span class="sy4">::</span><span class="me2">hardware_constructive_interference_size</span></span> and<br>
<p><span class="mw-geshi cpp source-cpp"><span class="kw4">constexpr</span> std<span class="sy4">::</span><span class="me2">hardware_destructive_interference_size</span></span>
</p>
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/hardware_destructive_interference_size&amp;action=edit&amp;section=2" title="Edit section: Example">edit</a>]</span> <span class="mw-headline" id="Example">Example</span></h3>
<div class="t-example"><p>The program uses two threads that atomically write to the data members of the given global objects. The first object fits in one cache line, which results in "hardware interference". The second object keeps its data members on separate cache lines, so possible "cache synchronization" after thread writes is avoided.</p><div class="t-example-live-link"><div class="coliru-btn coliru-btn-run-init">Run this code</div></div>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="co2">#include &lt;atomic&gt;</span>
<span class="co2">#include &lt;chrono&gt;</span>
<span class="co2">#include &lt;cstddef&gt;</span>
<span class="co2">#include &lt;iomanip&gt;</span>
<span class="co2">#include &lt;iostream&gt;</span>
<span class="co2">#include &lt;mutex&gt;</span>
<span class="co2">#include &lt;new&gt;</span>
<span class="co2">#include &lt;thread&gt;</span>
&nbsp;
<span class="co2">#ifdef __cpp_lib_hardware_interference_size</span>
    <span class="kw1">using</span> std<span class="sy4">::</span><span class="me2">hardware_constructive_interference_size</span><span class="sy4">;</span>
    <span class="kw1">using</span> std<span class="sy4">::</span><span class="me2">hardware_destructive_interference_size</span><span class="sy4">;</span>
<span class="co2">#else</span>
    <span class="co1">// 64 bytes on x86-64 │ L1_CACHE_BYTES │ L1_CACHE_SHIFT │ __cacheline_aligned │ ...</span>
    <span class="kw4">constexpr</span> <a href="../types/size_t.html"><span class="kw107">std::<span class="me2">size_t</span></span></a> hardware_constructive_interference_size <span class="sy1">=</span> <span class="nu0">64</span><span class="sy4">;</span>
    <span class="kw4">constexpr</span> <a href="../types/size_t.html"><span class="kw107">std::<span class="me2">size_t</span></span></a> hardware_destructive_interference_size <span class="sy1">=</span> <span class="nu0">64</span><span class="sy4">;</span>
<span class="co2">#endif</span>
&nbsp;
<a href="mutex.html"><span class="kw2173">std::<span class="me2">mutex</span></span></a> cout_mutex<span class="sy4">;</span>
&nbsp;
<span class="kw4">constexpr</span> <span class="kw4">int</span> max_write_iterations<span class="br0">{</span><span class="nu0">10</span><span class="st0">'000'</span><span class="nu8">000</span><span class="br0">}</span><span class="sy4">;</span> <span class="co1">// the benchmark time tuning</span>
&nbsp;
<span class="kw1">struct</span> alignas<span class="br0">(</span>hardware_constructive_interference_size<span class="br0">)</span>
OneCacheLiner <span class="co1">// occupies one cache line</span>
<span class="br0">{</span>
    <a href="../atomic/atomic.html"><span class="kw2144">std::<span class="me2">atomic_uint64_t</span></span></a> x<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span>
    <a href="../atomic/atomic.html"><span class="kw2144">std::<span class="me2">atomic_uint64_t</span></span></a> y<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span>
<span class="br0">}</span>
oneCacheLiner<span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> TwoCacheLiner <span class="co1">// occupies two cache lines</span>
<span class="br0">{</span>
    alignas<span class="br0">(</span>hardware_destructive_interference_size<span class="br0">)</span> <a href="../atomic/atomic.html"><span class="kw2144">std::<span class="me2">atomic_uint64_t</span></span></a> x<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span>
    alignas<span class="br0">(</span>hardware_destructive_interference_size<span class="br0">)</span> <a href="../atomic/atomic.html"><span class="kw2144">std::<span class="me2">atomic_uint64_t</span></span></a> y<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span>
<span class="br0">}</span>
twoCacheLiner<span class="sy4">;</span>
&nbsp;
<span class="kw1">inline</span> <span class="kw4">auto</span> now<span class="br0">(</span><span class="br0">)</span> <span class="kw1">noexcept</span> <span class="br0">{</span> <span class="kw1">return</span> <a href="../chrono/high_resolution_clock/now.html"><span class="kw2688">std::<span class="me2">chrono</span><span class="sy4">::</span><span class="me2">high_resolution_clock</span><span class="sy4">::</span><span class="me2">now</span></span></a><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> <span class="br0">}</span>
&nbsp;
<span class="kw1">template</span><span class="sy1">&lt;</span><span class="kw4">bool</span> xy<span class="sy1">&gt;</span>
<span class="kw4">void</span> oneCacheLinerThread<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw4">const</span> <span class="kw4">auto</span> start<span class="br0">{</span>now<span class="br0">(</span><span class="br0">)</span><span class="br0">}</span><span class="sy4">;</span>
&nbsp;
    <span class="kw1">for</span> <span class="br0">(</span>uint64_t count<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span> count <span class="sy3">!</span><span class="sy1">=</span> max_write_iterations<span class="sy4">;</span> <span class="sy2">++</span>count<span class="br0">)</span>
        <span class="kw1">if</span> <span class="kw4">constexpr</span> <span class="br0">(</span>xy<span class="br0">)</span>
            oneCacheLiner.<span class="me1">x</span>.<span class="me1">fetch_add</span><span class="br0">(</span><span class="nu0">1</span>, <a href="../atomic/memory_order.html"><span class="kw2114">std::<span class="me2">memory_order_relaxed</span></span></a><span class="br0">)</span><span class="sy4">;</span>
        <span class="kw1">else</span>
            oneCacheLiner.<span class="me1">y</span>.<span class="me1">fetch_add</span><span class="br0">(</span><span class="nu0">1</span>, <a href="../atomic/memory_order.html"><span class="kw2114">std::<span class="me2">memory_order_relaxed</span></span></a><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <span class="kw4">const</span> <a href="../chrono/duration.html"><span class="kw997">std::<span class="me2">chrono</span><span class="sy4">::</span><span class="me2">duration</span></span></a><span class="sy1">&lt;</span><span class="kw4">double</span>, <a href="../numeric/ratio/ratio.html"><span class="kw1539">std::<span class="me2">milli</span></span></a><span class="sy1">&gt;</span> elapsed<span class="br0">{</span>now<span class="br0">(</span><span class="br0">)</span> <span class="sy2">-</span> start<span class="br0">}</span><span class="sy4">;</span>
    <a href="lock_guard.html"><span class="kw2185">std::<span class="me2">lock_guard</span></span></a> lk<span class="br0">{</span>cout_mutex<span class="br0">}</span><span class="sy4">;</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"oneCacheLinerThread() spent "</span> <span class="sy1">&lt;&lt;</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" ms<span class="es1">\n</span>"</span><span class="sy4">;</span>
    <span class="kw1">if</span> <span class="kw4">constexpr</span> <span class="br0">(</span>xy<span class="br0">)</span>
        oneCacheLiner.<span class="me1">x</span> <span class="sy1">=</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    <span class="kw1">else</span>
        oneCacheLiner.<span class="me1">y</span> <span class="sy1">=</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">template</span><span class="sy1">&lt;</span><span class="kw4">bool</span> xy<span class="sy1">&gt;</span>
<span class="kw4">void</span> twoCacheLinerThread<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw4">const</span> <span class="kw4">auto</span> start<span class="br0">{</span>now<span class="br0">(</span><span class="br0">)</span><span class="br0">}</span><span class="sy4">;</span>
&nbsp;
    <span class="kw1">for</span> <span class="br0">(</span>uint64_t count<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span> count <span class="sy3">!</span><span class="sy1">=</span> max_write_iterations<span class="sy4">;</span> <span class="sy2">++</span>count<span class="br0">)</span>
        <span class="kw1">if</span> <span class="kw4">constexpr</span> <span class="br0">(</span>xy<span class="br0">)</span>
            twoCacheLiner.<span class="me1">x</span>.<span class="me1">fetch_add</span><span class="br0">(</span><span class="nu0">1</span>, <a href="../atomic/memory_order.html"><span class="kw2114">std::<span class="me2">memory_order_relaxed</span></span></a><span class="br0">)</span><span class="sy4">;</span>
        <span class="kw1">else</span>
            twoCacheLiner.<span class="me1">y</span>.<span class="me1">fetch_add</span><span class="br0">(</span><span class="nu0">1</span>, <a href="../atomic/memory_order.html"><span class="kw2114">std::<span class="me2">memory_order_relaxed</span></span></a><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <span class="kw4">const</span> <a href="../chrono/duration.html"><span class="kw997">std::<span class="me2">chrono</span><span class="sy4">::</span><span class="me2">duration</span></span></a><span class="sy1">&lt;</span><span class="kw4">double</span>, <a href="../numeric/ratio/ratio.html"><span class="kw1539">std::<span class="me2">milli</span></span></a><span class="sy1">&gt;</span> elapsed<span class="br0">{</span>now<span class="br0">(</span><span class="br0">)</span> <span class="sy2">-</span> start<span class="br0">}</span><span class="sy4">;</span>
    <a href="lock_guard.html"><span class="kw2185">std::<span class="me2">lock_guard</span></span></a> lk<span class="br0">{</span>cout_mutex<span class="br0">}</span><span class="sy4">;</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"twoCacheLinerThread() spent "</span> <span class="sy1">&lt;&lt;</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" ms<span class="es1">\n</span>"</span><span class="sy4">;</span>
    <span class="kw1">if</span> <span class="kw4">constexpr</span> <span class="br0">(</span>xy<span class="br0">)</span>
        twoCacheLiner.<span class="me1">x</span> <span class="sy1">=</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    <span class="kw1">else</span>
        twoCacheLiner.<span class="me1">y</span> <span class="sy1">=</span> elapsed.<span class="me1">count</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"__cpp_lib_hardware_interference_size "</span>
<span class="co2">#   ifdef __cpp_lib_hardware_interference_size</span>
        <span class="st0">"= "</span> <span class="sy1">&lt;&lt;</span> __cpp_lib_hardware_interference_size <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="sy4">;</span>
<span class="co2">#   else</span>
        <span class="st0">"is not defined, use "</span> <span class="sy1">&lt;&lt;</span> hardware_destructive_interference_size
                               <span class="sy1">&lt;&lt;</span> <span class="st0">" as fallback<span class="es1">\n</span>"</span><span class="sy4">;</span>
<span class="co2">#   endif</span>
&nbsp;
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"hardware_destructive_interference_size == "</span>
              <span class="sy1">&lt;&lt;</span> hardware_destructive_interference_size <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span>
              <span class="sy1">&lt;&lt;</span> <span class="st0">"hardware_constructive_interference_size == "</span>
              <span class="sy1">&lt;&lt;</span> hardware_constructive_interference_size <span class="sy1">&lt;&lt;</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>"</span>
              <span class="sy1">&lt;&lt;</span> <a href="../io/manip/fixed.html"><span class="kw1801">std::<span class="me2">fixed</span></span></a> <span class="sy1">&lt;&lt;</span> <a href="../io/manip/setprecision.html"><span class="kw1813">std::<span class="me2">setprecision</span></span></a><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span>
              <span class="sy1">&lt;&lt;</span> <span class="st0">"sizeof( OneCacheLiner ) == "</span> <span class="sy1">&lt;&lt;</span> sizeof<span class="br0">(</span>OneCacheLiner<span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span>
              <span class="sy1">&lt;&lt;</span> <span class="st0">"sizeof( TwoCacheLiner ) == "</span> <span class="sy1">&lt;&lt;</span> sizeof<span class="br0">(</span>TwoCacheLiner<span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"<span class="es1">\n</span><span class="es1">\n</span>"</span><span class="sy4">;</span>
&nbsp;
    <span class="kw4">constexpr</span> <span class="kw4">int</span> max_runs<span class="br0">{</span><span class="nu0">4</span><span class="br0">}</span><span class="sy4">;</span>
&nbsp;
    <span class="kw4">int</span> oneCacheLiner_average<span class="br0">{</span><span class="nu0">0</span><span class="br0">}</span><span class="sy4">;</span>
    <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">auto</span> i<span class="br0">{</span><span class="nu0">0</span><span class="br0">}</span><span class="sy4">;</span> i <span class="sy3">!</span><span class="sy1">=</span> max_runs<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">)</span>
    <span class="br0">{</span>
        <a href="thread.html"><span class="kw2167">std::<span class="me2">thread</span></span></a> th1<span class="br0">{</span>oneCacheLinerThread<span class="sy1">&lt;</span><span class="nu0">0</span><span class="sy1">&gt;</span><span class="br0">}</span><span class="sy4">;</span>
        <a href="thread.html"><span class="kw2167">std::<span class="me2">thread</span></span></a> th2<span class="br0">{</span>oneCacheLinerThread<span class="sy1">&lt;</span><span class="nu0">1</span><span class="sy1">&gt;</span><span class="br0">}</span><span class="sy4">;</span>
        th1.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
        th2.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
        oneCacheLiner_average <span class="sy2">+</span><span class="sy1">=</span> oneCacheLiner.<span class="me1">x</span> <span class="sy2">+</span> oneCacheLiner.<span class="me1">y</span><span class="sy4">;</span>
    <span class="br0">}</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Average T1 time: "</span>
              <span class="sy1">&lt;&lt;</span> <span class="br0">(</span>oneCacheLiner_average <span class="sy2">/</span> max_runs <span class="sy2">/</span> <span class="nu0">2</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" ms<span class="es1">\n</span><span class="es1">\n</span>"</span><span class="sy4">;</span>
&nbsp;
    <span class="kw4">int</span> twoCacheLiner_average<span class="br0">{</span><span class="nu0">0</span><span class="br0">}</span><span class="sy4">;</span>
    <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">auto</span> i<span class="br0">{</span><span class="nu0">0</span><span class="br0">}</span><span class="sy4">;</span> i <span class="sy3">!</span><span class="sy1">=</span> max_runs<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">)</span>
    <span class="br0">{</span>
        <a href="thread.html"><span class="kw2167">std::<span class="me2">thread</span></span></a> th1<span class="br0">{</span>twoCacheLinerThread<span class="sy1">&lt;</span><span class="nu0">0</span><span class="sy1">&gt;</span><span class="br0">}</span><span class="sy4">;</span>
        <a href="thread.html"><span class="kw2167">std::<span class="me2">thread</span></span></a> th2<span class="br0">{</span>twoCacheLinerThread<span class="sy1">&lt;</span><span class="nu0">1</span><span class="sy1">&gt;</span><span class="br0">}</span><span class="sy4">;</span>
        th1.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
        th2.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
        twoCacheLiner_average <span class="sy2">+</span><span class="sy1">=</span> twoCacheLiner.<span class="me1">x</span> <span class="sy2">+</span> twoCacheLiner.<span class="me1">y</span><span class="sy4">;</span>
    <span class="br0">}</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> <span class="st0">"Average T2 time: "</span>
              <span class="sy1">&lt;&lt;</span> <span class="br0">(</span>twoCacheLiner_average <span class="sy2">/</span> max_runs <span class="sy2">/</span> <span class="nu0">2</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" ms<span class="es1">\n</span><span class="es1">\n</span>"</span>
              <span class="sy1">&lt;&lt;</span> <span class="st0">"Ratio T1/T2:~ "</span>
              <span class="sy1">&lt;&lt;</span> <span class="nu16">1.0</span> <span class="sy2">*</span> oneCacheLiner_average <span class="sy2">/</span> twoCacheLiner_average <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<p>Possible output:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="text source-text"><pre class="de1">__cpp_lib_hardware_interference_size = 201703
hardware_destructive_interference_size == 64
hardware_constructive_interference_size == 64
&nbsp;
sizeof( OneCacheLiner ) == 64
sizeof( TwoCacheLiner ) == 128
&nbsp;
oneCacheLinerThread() spent 517.83 ms
oneCacheLinerThread() spent 533.43 ms
oneCacheLinerThread() spent 527.36 ms
oneCacheLinerThread() spent 555.69 ms
oneCacheLinerThread() spent 574.74 ms
oneCacheLinerThread() spent 591.66 ms
oneCacheLinerThread() spent 555.63 ms
oneCacheLinerThread() spent 555.76 ms
Average T1 time: 550 ms
&nbsp;
twoCacheLinerThread() spent 89.79 ms
twoCacheLinerThread() spent 89.94 ms
twoCacheLinerThread() spent 89.46 ms
twoCacheLinerThread() spent 90.28 ms
twoCacheLinerThread() spent 89.73 ms
twoCacheLinerThread() spent 91.11 ms
twoCacheLinerThread() spent 89.17 ms
twoCacheLinerThread() spent 90.09 ms
Average T2 time: 89 ms
&nbsp;
Ratio T1/T2:~ 6.16</pre></div></div> 
</div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/hardware_destructive_interference_size&amp;action=edit&amp;section=3" title="Edit section: See also">edit</a>]</span> <span class="mw-headline" id="See_also">See also</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="thread/hardware_concurrency.html" title="cpp/thread/thread/hardware concurrency"> <span class="t-lines"><span>hardware_concurrency</span></span></a></div><div><span class="t-lines"><span><span class="t-cmark">[static]</span></span></span></div></div>
</td>
<td>  returns the number of concurrent threads supported by the implementation <br> <span class="t-mark">(public static member function of <code>std::thread</code>)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/thread/dsc_hardware_concurrency&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="jthread/hardware_concurrency.html" title="cpp/thread/jthread/hardware concurrency"> <span class="t-lines"><span>hardware_concurrency</span></span></a></div><div><span class="t-lines"><span><span class="t-cmark">[static]</span></span></span></div></div>
</td>
<td>  returns the number of concurrent threads supported by the implementation <br> <span class="t-mark">(public static member function of <code>std::jthread</code>)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/thread/dsc_hardware_concurrency&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>

<!-- 
NewPP limit report
Preprocessor visited node count: 9354/1000000
Preprocessor generated node count: 11209/1000000
Post‐expand include size: 316670/4194304 bytes
Template argument size: 78150/4194304 bytes
Highest expansion depth: 32/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:14758-0!*!0!!*!*!* and timestamp 20250111195528 -->
</div>                    <!-- /bodycontent -->
                                        <!-- printfooter -->
                    <div class="printfooter">
                    Retrieved from "<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/hardware_destructive_interference_size&amp;oldid=179499">https://en.cppreference.com/mwiki/index.php?title=cpp/thread/hardware_destructive_interference_size&amp;oldid=179499</a>"                    </div>
                    <!-- /printfooter -->
                                                            <!-- catlinks -->
                    <div id="catlinks" class="catlinks catlinks-allhidden"></div>                    <!-- /catlinks -->
                                                            <div class="visualClear"></div>
                    <!-- debughtml -->
                                        <!-- /debughtml -->
                </div>
                <!-- /bodyContent -->
            </div>
        </div>
        <!-- /content -->
        <!-- footer -->
        
        <!-- /footer -->
        <script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=skins.cppreference2&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi","ext.gadget.ColiruCompiler","ext.gadget.StandardRevisions","ext.gadget.MathJax"], null, true);
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<!-- Served in 0.035 secs. -->
	




</body><!-- Cached 20250111201256 --><!-- Mirrored from en.cppreference.com/w/cpp/thread/hardware_destructive_interference_size by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:37:18 GMT --></html>