<!DOCTYPE html><html lang="en" dir="ltr" class="client-nojs"><!-- Mirrored from en.cppreference.com/w/cpp/thread/scoped_lock by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:37:29 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->

<title>std::scoped_lock</title>
<meta charset="UTF-8">
<meta name="generator" content="MediaWiki 1.21.2">







<meta name="ResourceLoaderDynamicStyles" content="">

<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}#toc{display:none}.editsection{display:none}
/* cache key: mwiki1-mwiki_en_:resourceloader:filter:minify-css:7:472787eddcf4605d11de8c7ef047234f */</style>




<style type="text/css">/*<![CDATA[*/
.source-cpp {line-height: normal;}
.source-cpp li, .source-cpp pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp
 * CSS class: source-cpp, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp.source-cpp .de1, .cpp.source-cpp .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cpp.source-cpp  {font-family:monospace;}
.cpp.source-cpp .imp {font-weight: bold; color: red;}
.cpp.source-cpp li, .cpp.source-cpp .li1 {font-weight: normal; vertical-align:top;}
.cpp.source-cpp .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp.source-cpp .li2 {font-weight: bold; vertical-align:top;}
.cpp.source-cpp .kw1 {color: #0000dd;}
.cpp.source-cpp .kw2 {color: #0000ff;}
.cpp.source-cpp .kw3 {color: #0000dd;}
.cpp.source-cpp .kw4 {color: #0000ff;}
.cpp.source-cpp .co1 {color: #909090;}
.cpp.source-cpp .co2 {color: #339900;}
.cpp.source-cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp.source-cpp .es0 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es1 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es2 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es3 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es4 {color: #008000; font-weight: bold;}
.cpp.source-cpp .es5 {color: #008000; font-weight: bold;}
.cpp.source-cpp .br0 {color: #008000;}
.cpp.source-cpp .sy0 {color: #008000;}
.cpp.source-cpp .sy1 {color: #000080;}
.cpp.source-cpp .sy2 {color: #000040;}
.cpp.source-cpp .sy3 {color: #000040;}
.cpp.source-cpp .sy4 {color: #008080;}
.cpp.source-cpp .st0 {color: #008000;}
.cpp.source-cpp .nu0 {color: #000080;}
.cpp.source-cpp .nu6 {color: #000080;}
.cpp.source-cpp .nu8 {color: #000080;}
.cpp.source-cpp .nu12 {color: #000080;}
.cpp.source-cpp .nu16 {color:#000080;}
.cpp.source-cpp .nu17 {color:#000080;}
.cpp.source-cpp .nu18 {color:#000080;}
.cpp.source-cpp .nu19 {color:#000080;}
.cpp.source-cpp .ln-xtra, .cpp.source-cpp li.ln-xtra, .cpp.source-cpp div.ln-xtra {background-color: #ffc;}
.cpp.source-cpp span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-text {line-height: normal;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.text.source-text .de1, .text.source-text .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.text.source-text  {font-family:monospace;}
.text.source-text .imp {font-weight: bold; color: red;}
.text.source-text li, .text.source-text .li1 {font-weight: normal; vertical-align:top;}
.text.source-text .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.text.source-text .li2 {font-weight: bold; vertical-align:top;}
.text.source-text .ln-xtra, .text.source-text li.ln-xtra, .text.source-text div.ln-xtra {background-color: #ffc;}
.text.source-text span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/mwiki/skins/cppreference2/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-cpp_thread_scoped_lock skin-cppreference2 action-view cpp-navbar">
        <!-- header -->
        
        <!-- /header -->
        <!-- content -->
<style type="text/css">
#carbonads {
  display: block;
  overflow: hidden;
  position: absolute;
  text-align: center;
  left: -170px;
  max-width: 150px;
  border-radius: 4px;
  border: solid 1px hsla(0, 0%, 0%, .1);
  background-color: hsl(0, 0%, 98%);
  font-size: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  display: block;
  margin-bottom: 8px;
  max-width: 150px;
  line-height: 1;
}

.carbon-img img {
  display: block;
  margin: 0 auto;
  max-width: 150px !important;
  width: 150px;
  height: auto;
}

.carbon-text {
  display: block;
  padding: 0 1em 8px;
}

.carbon-poweredby {
  display: block;
  padding: 8px 12px;
  background: repeating-linear-gradient(-45deg, transparent, transparent 5px, hsla(0, 0%, 0%, .025) 5px, hsla(0, 0%, 0%, .025) 10px) hsla(203, 11%, 95%, .4);
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 600;
  font-size: 9px;
  line-height: 1;
}
html { font-variant-ligatures: no-common-ligatures; }
</style>
        <div id="cpp-content-base">
            <div id="content">
                <a id="top"></a>
                <div id="mw-js-message" style="display:none;"></div>
                                <!-- firstHeading -->
<script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYITK7M&amp;placement=cppreferencecom" id="_carbonads_js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HW0LXMYCY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8HW0LXMYCY');
</script>
                <h1 id="firstHeading" class="firstHeading"><span style="font-size:0.7em; line-height:130%">std::</span>scoped_lock</h1>
                <!-- /firstHeading -->
                <!-- bodyContent -->
                <div id="bodyContent">
                                        <!-- tagline -->
                    
                    <!-- /tagline -->
                                        <!-- subtitle -->
                    
                    <!-- /subtitle -->
                                                            <!-- bodycontent -->
                    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<table class="t-dcl-begin"><tbody>
<tr class="t-dsc-header">
<td> <div>Defined in header <code><a href="../header/mutex.html" title="cpp/header/mutex">&lt;mutex&gt;</a></code>
 </div></td>
<td></td>
<td></td>
</tr>
<tr class="t-dcl t-since-cxx17">
<td> <div><span class="mw-geshi cpp source-cpp"><span class="kw1">template</span><span class="sy1">&lt;</span> <span class="kw1">class</span>... <span class="me1">MutexTypes</span> <span class="sy1">&gt;</span><br>
<span class="kw1">class</span> scoped_lock<span class="sy4">;</span></span></div></td>
<td class="t-dcl-nopad">  </td>
<td> <span class="t-mark-rev t-since-cxx17">(since C++17)</span> </td>
</tr>
<tr class="t-dcl-sep"><td></td><td></td><td></td></tr>
</tbody></table>
<p>The class <code>scoped_lock</code> is a mutex wrapper that provides a convenient <a href="https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization" class="extiw" title="enwiki:Resource Acquisition Is Initialization">RAII-style</a> mechanism for owning zero or more mutexes for the duration of a scoped block.
</p><p>When a <code>scoped_lock</code> object is created, it attempts to take ownership of the mutexes it is given. When control leaves the scope in which the <code>scoped_lock</code> object was created, the <code>scoped_lock</code> is destructed and the mutexes are released. If several mutexes are given, deadlock avoidance algorithm is used as if by <span class="t-lc"><a href="lock.html" title="cpp/thread/lock">std::lock</a></span>.
</p><p>The <code>scoped_lock</code> class is non-copyable.
</p>
<table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Template_parameters"><span class="tocnumber">1</span> <span class="toctext">Template parameters</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Member_types"><span class="tocnumber">2</span> <span class="toctext">Member types</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Member_functions"><span class="tocnumber">3</span> <span class="toctext">Member functions</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Notes"><span class="tocnumber">4</span> <span class="toctext">Notes</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Example"><span class="tocnumber">5</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Defect_reports"><span class="tocnumber">6</span> <span class="toctext">Defect reports</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=1" title="Edit section: Template parameters">edit</a>]</span> <span class="mw-headline" id="Template_parameters">Template parameters</span></h3>
<table class="t-par-begin">


<tbody><tr class="t-par">
<td> MutexTypes
</td>
<td> -
</td>
<td> the types of the mutexes to lock. The types must meet the <a href="../named_req/Lockable.html" title="cpp/named req/Lockable"><span style="font-family: Georgia, 'DejaVu Serif', serif; font-style:italic">Lockable</span></a> requirements unless <span class="t-c"><span class="mw-geshi cpp source-cpp">sizeof...<span class="br0">(</span>MutexTypes<span class="br0">)</span> <span class="sy1">==</span> <span class="nu0">1</span></span></span>, in which case the only type must meet <a href="../named_req/BasicLockable.html" title="cpp/named req/BasicLockable"><span style="font-family: Georgia, 'DejaVu Serif', serif; font-style:italic">BasicLockable</span></a>
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=2" title="Edit section: Member types">edit</a>]</span> <span class="mw-headline" id="Member_types">Member types</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc-hitem">
<td> Member type
</td>
<td> Definition
</td></tr>


<tr class="t-dsc">
<td> <code>mutex_type</code><br><span class="t-mark">(conditionally present)</span>
</td>
<td>
<p>If <span class="t-c"><span class="mw-geshi cpp source-cpp">sizeof...<span class="br0">(</span>MutexTypes<span class="br0">)</span> <span class="sy1">==</span> <span class="nu0">1</span></span></span>, member type <code>mutex_type</code> is the same as <code>Mutex</code>, the sole type in <code>MutexTypes...</code>.
Otherwise, there is no member <code>mutex_type</code>.
</p>
</td></tr>

</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=3" title="Edit section: Member functions">edit</a>]</span> <span class="mw-headline" id="Member_functions">Member functions</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div t-dsc-member-nobold-div"><div><a href="scoped_lock/scoped_lock.html" title="cpp/thread/scoped lock/scoped lock"> <span class="t-lines"><span>(constructor)</span></span></a></div></div>
</td>
<td>  constructs a <code>scoped_lock</code>, optionally locking the given mutexes <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/scoped_lock/dsc_constructor&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div t-dsc-member-nobold-div"><div><a href="scoped_lock/_scoped_lock.html" title="cpp/thread/scoped lock/~scoped lock"> <span class="t-lines"><span>(destructor)</span></span></a></div></div>
</td>
<td>  destructs the <code>scoped_lock</code> object, unlocks the underlying mutexes <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/scoped_lock/dsc_destructor&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><span class="t-lines"><span>operator=</span></span></div><div><span class="t-lines"><span><span class="t-cmark">[deleted]</span></span></span></div></div>
</td>
<td>  not copy-assignable <br> <span class="t-mark">(public member function)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/scoped_lock/dsc_operator%3D&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=4" title="Edit section: Notes">edit</a>]</span> <span class="mw-headline" id="Notes">Notes</span></h3>
<p>A common beginner error is to "forget" to give a <code>scoped_lock</code> variable a name, e.g. <span class="t-c"><span class="mw-geshi cpp source-cpp">std<span class="sy4">::</span><span class="me2">scoped_lock</span><span class="br0">(</span>mtx<span class="br0">)</span><span class="sy4">;</span></span></span> (which default constructs a <code>scoped_lock</code> variable named <code>mtx</code>) or <span class="t-c"><span class="mw-geshi cpp source-cpp">std<span class="sy4">::</span><span class="me2">scoped_lock</span><span class="br0">{</span>mtx<span class="br0">}</span><span class="sy4">;</span></span></span> (which constructs a prvalue object that is immediately destroyed), thereby not actually constructing a lock that holds a mutex for the rest of the scope.
</p>
<table class="wikitable ftm-begin ftm-has-value">

<tbody><tr>
<th><a href="../utility/feature_test.html" title="cpp/utility/feature test">Feature-test</a> macro</th>
<th><abbr title="The year/month in which the feature was adopted. The hyperlink under each value opens a compiler support page with entry for given feature.">Value</abbr></th>
<th><abbr title="Standard in which the feature is introduced; DR means defect report against that revision">Std</abbr></th>
<th>Feature
</th></tr>
<tr>
<td><a href="../feature_test.html#cpp_lib_scoped_lock" title="cpp/feature test"><code>__cpp_lib_scoped_lock</code></a></td>
<td><a href="../compiler_support/17.html#cpp_lib_scoped_lock_201703L" title="cpp/compiler support/17"><code>201703L</code></a></td>
<td><span class="t-mark">(C++17)</span></td>
<td><a href="#Top"><code>std::scoped_lock</code></a>
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=5" title="Edit section: Example">edit</a>]</span> <span class="mw-headline" id="Example">Example</span></h3>
<div class="t-example"><p>The following example uses <code>std::scoped_lock</code> to lock pairs of mutexes without deadlock and is RAII-style.</p><div class="t-example-live-link"><div class="coliru-btn coliru-btn-run-init">Run this code</div></div>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="cpp source-cpp"><pre class="de1"><span class="co2">#include &lt;chrono&gt;</span>
<span class="co2">#include &lt;functional&gt;</span>
<span class="co2">#include &lt;iostream&gt;</span>
<span class="co2">#include &lt;mutex&gt;</span>
<span class="co2">#include &lt;string&gt;</span>
<span class="co2">#include &lt;thread&gt;</span>
<span class="co2">#include &lt;vector&gt;</span>
<span class="kw1">using</span> <span class="kw1">namespace</span> std<span class="sy4">::</span><span class="me2">chrono_literals</span><span class="sy4">;</span>
&nbsp;
<span class="kw1">struct</span> Employee
<span class="br0">{</span>
    <a href="../container/vector.html"><span class="kw1277">std::<span class="me2">vector</span></span></a><span class="sy1">&lt;</span><a href="../string/basic_string.html"><span class="kw1238">std::<span class="me2">string</span></span></a><span class="sy1">&gt;</span> lunch_partners<span class="sy4">;</span>
    <a href="../string/basic_string.html"><span class="kw1238">std::<span class="me2">string</span></span></a> id<span class="sy4">;</span>
    <a href="mutex.html"><span class="kw2175">std::<span class="me2">mutex</span></span></a> m<span class="sy4">;</span>
    Employee<span class="br0">(</span><a href="../string/basic_string.html"><span class="kw1238">std::<span class="me2">string</span></span></a> id<span class="br0">)</span> <span class="sy4">:</span> id<span class="br0">(</span>id<span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
    <a href="../string/basic_string.html"><span class="kw1238">std::<span class="me2">string</span></span></a> partners<span class="br0">(</span><span class="br0">)</span> <span class="kw4">const</span>
    <span class="br0">{</span>
        <a href="../string/basic_string.html"><span class="kw1238">std::<span class="me2">string</span></span></a> ret <span class="sy1">=</span> <span class="st0">"Employee "</span> <span class="sy2">+</span> id <span class="sy2">+</span> <span class="st0">" has lunch partners: "</span><span class="sy4">;</span>
        <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">int</span> count<span class="br0">{</span><span class="br0">}</span><span class="sy4">;</span> <span class="kw4">const</span> <span class="kw4">auto</span><span class="sy3">&amp;</span> partner <span class="sy4">:</span> lunch_partners<span class="br0">)</span>
            ret <span class="sy2">+</span><span class="sy1">=</span> <span class="br0">(</span>count<span class="sy2">++</span> <span class="sy4">?</span> <span class="st0">", "</span> <span class="sy4">:</span> <span class="st0">""</span><span class="br0">)</span> <span class="sy2">+</span> partner<span class="sy4">;</span>
        <span class="kw1">return</span> ret<span class="sy4">;</span>
    <span class="br0">}</span>
<span class="br0">}</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> send_mail<span class="br0">(</span>Employee<span class="sy3">&amp;</span>, Employee<span class="sy3">&amp;</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="co1">// Simulate a time-consuming messaging operation</span>
    <a href="sleep_for.html"><span class="kw2170">std::<span class="me2">this_thread</span><span class="sy4">::</span><span class="me2">sleep_for</span></span></a><span class="br0">(</span>1s<span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> assign_lunch_partner<span class="br0">(</span>Employee<span class="sy3">&amp;</span> e1, Employee<span class="sy3">&amp;</span> e2<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw4">static</span> <a href="mutex.html"><span class="kw2175">std::<span class="me2">mutex</span></span></a> io_mutex<span class="sy4">;</span>
    <span class="br0">{</span>
        <a href="lock_guard.html"><span class="kw2187">std::<span class="me2">lock_guard</span></span></a><span class="sy1">&lt;</span><a href="mutex.html"><span class="kw2175">std::<span class="me2">mutex</span></span></a><span class="sy1">&gt;</span> lk<span class="br0">(</span>io_mutex<span class="br0">)</span><span class="sy4">;</span>
        <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> e1.<span class="me1">id</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" and "</span> <span class="sy1">&lt;&lt;</span> e2.<span class="me1">id</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" are waiting for locks"</span> <span class="sy1">&lt;&lt;</span> <a href="../io/manip/endl.html"><span class="kw1808">std::<span class="me2">endl</span></span></a><span class="sy4">;</span>
    <span class="br0">}</span>
&nbsp;
    <span class="br0">{</span>
        <span class="co1">// Use std::scoped_lock to acquire two locks without worrying about</span>
        <span class="co1">// other calls to assign_lunch_partner deadlocking us</span>
        <span class="co1">// and it also provides a convenient RAII-style mechanism</span>
&nbsp;
        std<span class="sy4">::</span><span class="me2">scoped_lock</span> lock<span class="br0">(</span>e1.<span class="me1">m</span>, e2.<span class="me1">m</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
        <span class="co1">// Equivalent code 1 (using std::lock and std::lock_guard)</span>
        <span class="co1">// std::lock(e1.m, e2.m);</span>
        <span class="co1">// std::lock_guard&lt;std::mutex&gt; lk1(e1.m, std::adopt_lock);</span>
        <span class="co1">// std::lock_guard&lt;std::mutex&gt; lk2(e2.m, std::adopt_lock);</span>
&nbsp;
        <span class="co1">// Equivalent code 2 (if unique_locks are needed, e.g. for condition variables)</span>
        <span class="co1">// std::unique_lock&lt;std::mutex&gt; lk1(e1.m, std::defer_lock);</span>
        <span class="co1">// std::unique_lock&lt;std::mutex&gt; lk2(e2.m, std::defer_lock);</span>
        <span class="co1">// std::lock(lk1, lk2);</span>
        <span class="br0">{</span>
            <a href="lock_guard.html"><span class="kw2187">std::<span class="me2">lock_guard</span></span></a><span class="sy1">&lt;</span><a href="mutex.html"><span class="kw2175">std::<span class="me2">mutex</span></span></a><span class="sy1">&gt;</span> lk<span class="br0">(</span>io_mutex<span class="br0">)</span><span class="sy4">;</span>
            <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> e1.<span class="me1">id</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" and "</span> <span class="sy1">&lt;&lt;</span> e2.<span class="me1">id</span> <span class="sy1">&lt;&lt;</span> <span class="st0">" got locks"</span> <span class="sy1">&lt;&lt;</span> <a href="../io/manip/endl.html"><span class="kw1808">std::<span class="me2">endl</span></span></a><span class="sy4">;</span>
        <span class="br0">}</span>
        e1.<span class="me1">lunch_partners</span>.<span class="me1">push_back</span><span class="br0">(</span>e2.<span class="me1">id</span><span class="br0">)</span><span class="sy4">;</span>
        e2.<span class="me1">lunch_partners</span>.<span class="me1">push_back</span><span class="br0">(</span>e1.<span class="me1">id</span><span class="br0">)</span><span class="sy4">;</span>
    <span class="br0">}</span>
&nbsp;
    send_mail<span class="br0">(</span>e1, e2<span class="br0">)</span><span class="sy4">;</span>
    send_mail<span class="br0">(</span>e2, e1<span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    Employee alice<span class="br0">(</span><span class="st0">"Alice"</span><span class="br0">)</span>, bob<span class="br0">(</span><span class="st0">"Bob"</span><span class="br0">)</span>, christina<span class="br0">(</span><span class="st0">"Christina"</span><span class="br0">)</span>, dave<span class="br0">(</span><span class="st0">"Dave"</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <span class="co1">// Assign in parallel threads because mailing users about lunch assignments</span>
    <span class="co1">// takes a long time</span>
    <a href="../container/vector.html"><span class="kw1277">std::<span class="me2">vector</span></span></a><span class="sy1">&lt;</span><a href="thread.html"><span class="kw2167">std::<span class="me2">thread</span></span></a><span class="sy1">&gt;</span> threads<span class="sy4">;</span>
    threads.<span class="me1">emplace_back</span><span class="br0">(</span>assign_lunch_partner, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>alice<span class="br0">)</span>, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>bob<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    threads.<span class="me1">emplace_back</span><span class="br0">(</span>assign_lunch_partner, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>christina<span class="br0">)</span>, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>bob<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    threads.<span class="me1">emplace_back</span><span class="br0">(</span>assign_lunch_partner, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>christina<span class="br0">)</span>, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>alice<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
    threads.<span class="me1">emplace_back</span><span class="br0">(</span>assign_lunch_partner, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>dave<span class="br0">)</span>, <a href="../utility/functional/ref.html"><span class="kw1076">std::<span class="me2">ref</span></span></a><span class="br0">(</span>bob<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">auto</span><span class="sy3">&amp;</span> thread <span class="sy4">:</span> threads<span class="br0">)</span>
        thread.<span class="me1">join</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
    <a href="../io/cout.html"><span class="kw1775">std::<span class="me2">cout</span></span></a> <span class="sy1">&lt;&lt;</span> alice.<span class="me1">partners</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span>  <span class="sy1">&lt;&lt;</span> bob.<span class="me1">partners</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span>
              <span class="sy1">&lt;&lt;</span> christina.<span class="me1">partners</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span> <span class="sy1">&lt;&lt;</span> dave.<span class="me1">partners</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<p>Possible output:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="text source-text"><pre class="de1">Alice and Bob are waiting for locks
Alice and Bob got locks
Christina and Bob are waiting for locks
Christina and Alice are waiting for locks
Dave and Bob are waiting for locks
Dave and Bob got locks
Christina and Alice got locks
Christina and Bob got locks
Employee Alice has lunch partners: Bob, Christina
Employee Bob has lunch partners: Alice, Dave, Christina
Employee Christina has lunch partners: Alice, Bob
Employee Dave has lunch partners: Bob</pre></div></div> 
</div>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=6" title="Edit section: Defect reports">edit</a>]</span> <span class="mw-headline" id="Defect_reports">Defect reports</span></h3>
<p>The following behavior-changing defect reports were applied retroactively to previously published C++ standards.
</p>
<table class="dsctable" style="font-size:0.8em">
<tbody><tr>
<th>DR
</th>
<th>Applied to
</th>
<th>Behavior as published
</th>
<th>Correct behavior
</th></tr>
<tr>
<td><a rel="nofollow" class="external text" href="https://cplusplus.github.io/LWG/issue2981">LWG 2981</a>
</td>
<td>C++17
</td>
<td>redundant deduction guide from <code>scoped_lock&lt;MutexTypes...&gt;</code> was provided
</td>
<td>removed
</td></tr></tbody></table>
<h3><span class="editsection">[<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;action=edit&amp;section=7" title="Edit section: See also">edit</a>]</span> <span class="mw-headline" id="See_also">See also</span></h3>
<table class="t-dsc-begin">

<tbody><tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="unique_lock.html" title="cpp/thread/unique lock"> <span class="t-lines"><span>unique_lock</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  implements movable mutex ownership wrapper <br> <span class="t-mark">(class template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/dsc_unique_lock&amp;action=edit">[edit]</a></span>
</td></tr>

<tr class="t-dsc">
<td>  <div class="t-dsc-member-div"><div><a href="lock_guard.html" title="cpp/thread/lock guard"> <span class="t-lines"><span>lock_guard</span></span></a></div><div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">(C++11)</span></span></span></div></div>
</td>
<td>  implements a strictly scope-based mutex ownership wrapper <br> <span class="t-mark">(class template)</span> <span class="editsection noprint plainlinks" title="Edit this template"><a rel="nofollow" class="external text" href="https://en.cppreference.com/mwiki/index.php?title=Template:cpp/thread/dsc_lock_guard&amp;action=edit">[edit]</a></span>
</td></tr>
</tbody></table>

<!-- 
NewPP limit report
Preprocessor visited node count: 9920/1000000
Preprocessor generated node count: 14145/1000000
Postâ€expand include size: 334125/4194304 bytes
Template argument size: 74548/4194304 bytes
Highest expansion depth: 20/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:15847-0!*!0!!en!*!* and timestamp 20250105123842 -->
</div>                    <!-- /bodycontent -->
                                        <!-- printfooter -->
                    <div class="printfooter">
                    Retrieved from "<a href="https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;oldid=173481">https://en.cppreference.com/mwiki/index.php?title=cpp/thread/scoped_lock&amp;oldid=173481</a>"                    </div>
                    <!-- /printfooter -->
                                                            <!-- catlinks -->
                    <div id="catlinks" class="catlinks catlinks-allhidden"></div>                    <!-- /catlinks -->
                                                            <div class="visualClear"></div>
                    <!-- debughtml -->
                                        <!-- /debughtml -->
                </div>
                <!-- /bodyContent -->
            </div>
        </div>
        <!-- /content -->
        <!-- footer -->
        
        <!-- /footer -->
        <script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=skins.cppreference2&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi","ext.gadget.ColiruCompiler","ext.gadget.StandardRevisions","ext.gadget.MathJax"], null, true);
}</script>
<script src="https://en.cppreference.com/mwiki/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<!-- Served in 1.860 secs. -->
	




</body><!-- Cached 20250105123843 --><!-- Mirrored from en.cppreference.com/w/cpp/thread/scoped_lock by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jan 2025 11:37:30 GMT --></html>